<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: "en" }}">

  {% include head.html %}

  <body class="{{ page.layout}}">

    {% if page.layout != 'home' %}
      {% include header.html %}
    {% endif %}

    <main class="page-content" aria-label="Content">
        {{ content }}
    </main>

    {% if page.layout == 'home' %}
      <script type="text/javascript" src="{{ site.baseurl }}/assets/scripts/imagesloaded.pkgd.min.js"></script>
      <script type="text/javascript" src="{{ site.baseurl }}/assets/scripts/simpleslider.min.js"></script>

      <script>
        document.documentElement.scrollTop = -100;
        document.addEventListener('DOMContentLoaded',function(){
          document.documentElement.scrollTop = -100;
          document.documentElement.classList.add('js-loading');

          // imagesLoaded( document.getElementById('hero-image-slider'), function( instance ) {
          var sliderImages = document.querySelectorAll('#hero-image-slider img');
          var sliderImagesLoaded = 0;
          sliderImages.forEach(image => {
            image.addEventListener('load',function(){
              console.log('image ' + image.getAttribute('src').substring(image.getAttribute('src').lastIndexOf('/')+1) + ' loaded');
              sliderImagesLoaded++;
              console.log(sliderImagesLoaded + ">=" + sliderImages.length + '?');
              if(sliderImagesLoaded >= sliderImages.length) {
                console.log('all images loaded');
                sliderImages.forEach(image => {
                  image.removeEventListener('load');
                });
                document.documentElement.scrollTop = -100;
                setTimeout(function(){
                  document.documentElement.scrollTop = -100;
                  document.documentElement.classList.remove('js-loading');
                  simpleslider.getSlider({
                    container: document.getElementById('hero-image-slider'),
                    prop: 'opacity',
                    init: 0,
                    show: 1,
                    end: 0,
                    unit: '',
                    duration: 1
                  });
                },4000);
              }
            });
          });
        });
      </script>

      <script>
        document.addEventListener('DOMContentLoaded',function(){

          if ('IntersectionObserver' in window && 'IntersectionObserverEntry' in window && 'intersectionRatio' in window.IntersectionObserverEntry.prototype) {

            var aos = {
              offset: 120,
              delay: 0,
              easing: "ease",
              duration: 400,
              disable: !1,
              once: !1,
              startEvent: "DOMContentLoaded"
            };

            document.querySelector("body").classList.add('aos');
            document.querySelector("body").setAttribute("data-aos-easing", aos.easing),
            document.querySelector("body").setAttribute("data-aos-duration", aos.duration);
            document.querySelector("body").setAttribute("data-aos-delay", aos.delay);

            var aosOptions = {
              threshold: [0,.25,.5,.75],
              rootMargin: '30px 30px'
            };

            var aos = document.querySelectorAll("[data-aos]");

            var aosCallback =  function(entries, observer) {
              entries.forEach(entry => {
                if(entry.intersectionRatio >= .5 && entry.target.classList.contains('lazyload')) {
                  entry.target.setAttribute('srcset',entry.target.getAttribute('data-srcset'));
                  entry.target.classList.remove('lazyload');
                }
                if(entry.intersectionRatio >= .25) {
                  entry.target.classList.add('aos-animate');
                }
                else if(entry.intersectionRatio == 0) {
                  entry.target.classList.remove('aos-animate');
                }
              });
            }

            var aosObserver = new IntersectionObserver(aosCallback, aosOptions);

            aos.forEach(image => {
              aosObserver.observe(image);
            });

            var lazyloadOptions = {
              threshold: [0],
              rootMargin: '30px 30px'
            };

            var lazyload = document.querySelectorAll("[data-lazyload]");

            var lazyloadCallback =  function(entries, observer) {
              entries.forEach(entry => {

                if(entry.intersectionRatio > 0 && (entry.target.getAttribute('data-lazyload') != 'loaded')) {
                  entry.target.setAttribute('srcset',entry.target.getAttribute('data-srcset'));
                  entry.target.setAttribute('data-lazyload','loaded');
                  console.log('image ' + entry.target.getAttribute('src').substring(entry.target.getAttribute('src').lastIndexOf('/')+1) + ' lazyloaded');
                }
              });
            }

            var lazyloadObserver = new IntersectionObserver(lazyloadCallback, lazyloadOptions);

            lazyload.forEach(image => {
              lazyloadObserver.observe(image);
            });



          }
          else {
            // @todo: trigger lazy load switch now as no intersection observer exists!
            console.log('intersection observer not available.');
            lazyload.forEach(image => {
              image.setAttribute('srcset',entry.target.getAttribute('data-srcset'));
              image.setAttribute('data-lazyload',false);
            });
          }
        });
      </script>

    {% endif %}

  </body>

</html>
